<ng-container *ngIf="blockSet$ | async as blockSet">
  <div class="main" *ngIf="!comparisonViewOpen">
    <div class="title">Group Molecule Cart</div>
    <div class="control_bar">
      <div class="search">
        <svg
          width="19"
          height="19"
          viewBox="0 0 19 19"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          class="icon"
        >
          <path
            d="M8 16C9.77498 15.9996 11.4988 15.4054 12.897 14.312L17.293 18.708L18.707 17.294L14.311 12.898C15.405 11.4997 15.9996 9.77544 16 8C16 3.589 12.411 0 8 0C3.589 0 0 3.589 0 8C0 12.411 3.589 16 8 16ZM8 2C11.309 2 14 4.691 14 8C14 11.309 11.309 14 8 14C4.691 14 2 11.309 2 8C2 4.691 4.691 2 8 2Z"
            fill="black"
          />
        </svg>
        <input />
      </div>
      <p-dropdown [options]="viewModes" [(ngModel)]="currentViewMode">
        <ng-template pTemplate="selectedItem">
          <div class="dropdown_content" *ngIf="currentViewMode === 'gallery'">
            <svg
              width="28"
              height="28"
              viewBox="0 0 28 28"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M1.625 5C1.625 4.10489 1.98058 3.24645 2.61351 2.61351C3.24645 1.98058 4.10489 1.625 5 1.625H8.375C9.27011 1.625 10.1285 1.98058 10.7615 2.61351C11.3944 3.24645 11.75 4.10489 11.75 5V8.375C11.75 9.27011 11.3944 10.1285 10.7615 10.7615C10.1285 11.3944 9.27011 11.75 8.375 11.75H5C4.10489 11.75 3.24645 11.3944 2.61351 10.7615C1.98058 10.1285 1.625 9.27011 1.625 8.375V5ZM1.625 19.625C1.625 18.7299 1.98058 17.8715 2.61351 17.2385C3.24645 16.6056 4.10489 16.25 5 16.25H8.375C9.27011 16.25 10.1285 16.6056 10.7615 17.2385C11.3944 17.8715 11.75 18.7299 11.75 19.625V23C11.75 23.8951 11.3944 24.7535 10.7615 25.3865C10.1285 26.0194 9.27011 26.375 8.375 26.375H5C4.10489 26.375 3.24645 26.0194 2.61351 25.3865C1.98058 24.7535 1.625 23.8951 1.625 23V19.625ZM16.25 5C16.25 4.10489 16.6056 3.24645 17.2385 2.61351C17.8715 1.98058 18.7299 1.625 19.625 1.625H23C23.8951 1.625 24.7535 1.98058 25.3865 2.61351C26.0194 3.24645 26.375 4.10489 26.375 5V8.375C26.375 9.27011 26.0194 10.1285 25.3865 10.7615C24.7535 11.3944 23.8951 11.75 23 11.75H19.625C18.7299 11.75 17.8715 11.3944 17.2385 10.7615C16.6056 10.1285 16.25 9.27011 16.25 8.375V5ZM16.25 19.625C16.25 18.7299 16.6056 17.8715 17.2385 17.2385C17.8715 16.6056 18.7299 16.25 19.625 16.25H23C23.8951 16.25 24.7535 16.6056 25.3865 17.2385C26.0194 17.8715 26.375 18.7299 26.375 19.625V23C26.375 23.8951 26.0194 24.7535 25.3865 25.3865C24.7535 26.0194 23.8951 26.375 23 26.375H19.625C18.7299 26.375 17.8715 26.0194 17.2385 25.3865C16.6056 24.7535 16.25 23.8951 16.25 23V19.625Z"
                stroke="#1E1E1E"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
            <div>Gallery View</div>
          </div>
          <div class="dropdown_content" *ngIf="currentViewMode === 'list'">
            <svg
              width="36"
              height="36"
              viewBox="0 0 36 36"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M12.375 10.125H30.375M12.375 18H30.375M12.375 25.875H30.375M5.625 10.125H5.6355V10.137H5.625V10.125ZM6.1875 10.125C6.1875 10.2742 6.12824 10.4173 6.02275 10.5227C5.91726 10.6282 5.77418 10.6875 5.625 10.6875C5.47582 10.6875 5.33274 10.6282 5.22725 10.5227C5.12176 10.4173 5.0625 10.2742 5.0625 10.125C5.0625 9.97582 5.12176 9.83274 5.22725 9.72725C5.33274 9.62176 5.47582 9.5625 5.625 9.5625C5.77418 9.5625 5.91726 9.62176 6.02275 9.72725C6.12824 9.83274 6.1875 9.97582 6.1875 10.125ZM5.625 18H5.6355V18.012H5.625V18ZM6.1875 18C6.1875 18.1492 6.12824 18.2923 6.02275 18.3977C5.91726 18.5032 5.77418 18.5625 5.625 18.5625C5.47582 18.5625 5.33274 18.5032 5.22725 18.3977C5.12176 18.2923 5.0625 18.1492 5.0625 18C5.0625 17.8508 5.12176 17.7077 5.22725 17.6023C5.33274 17.4968 5.47582 17.4375 5.625 17.4375C5.77418 17.4375 5.91726 17.4968 6.02275 17.6023C6.12824 17.7077 6.1875 17.8508 6.1875 18ZM5.625 25.875H5.6355V25.887H5.625V25.875ZM6.1875 25.875C6.1875 26.0242 6.12824 26.1673 6.02275 26.2727C5.91726 26.3782 5.77418 26.4375 5.625 26.4375C5.47582 26.4375 5.33274 26.3782 5.22725 26.2727C5.12176 26.1673 5.0625 26.0242 5.0625 25.875C5.0625 25.7258 5.12176 25.5827 5.22725 25.4773C5.33274 25.3718 5.47582 25.3125 5.625 25.3125C5.77418 25.3125 5.91726 25.3718 6.02275 25.4773C6.12824 25.5827 6.1875 25.7258 6.1875 25.875Z"
                stroke="#1E1E1E"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
            <div>List View</div>
          </div>
        </ng-template>
        <ng-template let-mode pTemplate="item">
          <div>{{ mode == "gallery" ? "Gallery View" : "List View" }}</div>
        </ng-template>
      </p-dropdown>
    </div>
    <ng-container *ngIf="currentViewMode === 'gallery'">
      <div
        class="molecules"
        [class.shrunk]="selected.length"
        *ngIf="(groupCart$ | async)!.length; else placeholder"
      >
        <div class="molecule" *ngFor="let molecule of groupCart$ | async">
          <dmm-molecule-summary [molecule]="molecule" [blockSet]="blockSet">
            <div action class="action-buttons">
              <p-button
                label="Compare"
                [disabled]="
                  selected.includes(molecule) || selected.length === 3
                "
                (click)="selected.push(molecule)"
              ></p-button>
              <!--              <p-button label="View Details"></p-button>-->
            </div>
          </dmm-molecule-summary>
        </div>
      </div>
    </ng-container>
    <ng-container *ngIf="currentViewMode === 'list'">
      <p-table
        [value]="(groupCart$ | async)!"
        [tableStyle]="{ 'min-width': '50rem' }"
      >
        <ng-template pTemplate="header">
          <tr>
            <th *ngFor="let property of blockSet.firstTierProperties">
              {{ property.label }}
            </th>
            <th *ngFor="let property of blockSet.secondTierProperties">
              {{ property.label }}
            </th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-molecule>
          <tr *ngIf="blockSet$ | async as blockSet">
            <td
              *ngFor="let property of blockSet.firstTierProperties"
              [innerHTML]="
                lookupProperty(molecule.blockList, blockSet, property)
                  | chemicalProperty: property.displayStrategy
              "
            ></td>
            <td
              *ngFor="let property of blockSet.secondTierProperties"
              [innerHTML]="
                lookupProperty(molecule.blockList, blockSet, property)
                  | chemicalProperty: property.displayStrategy
              "
            ></td>
          </tr>
        </ng-template>
      </p-table>
    </ng-container>
    <div class="return-button">
      <p-button
        label="Return to Molecule Builder"
        (click)="goBackToWorkspace()"
      ></p-button>
    </div>
  </div>

  <ng-template #placeholder>
    <p>The cart is empty</p>
  </ng-template>

  <div class="main comparison" *ngIf="comparisonViewOpen">
    <div class="title">Compare Molecule Details</div>
    <div
      class="compared_molecules"
      *ngIf="(groupCart$ | async)!.length; else placeholder"
    >
      <div class="molecule" *ngFor="let molecule of selected">
        <dmm-molecule-detail
          [molecule]="molecule"
          [blockSet]="blockSet"
        ></dmm-molecule-detail>
      </div>
    </div>
    <div class="return-button">
      <p-button
        label="Return to Molecule Cart"
        (click)="comparisonViewOpen = false"
      ></p-button>
    </div>
  </div>

  <div
    class="selection_panel"
    [class.show]="selected.length && !comparisonViewOpen"
  >
    <svg
      (click)="selected.length = 0"
      class="close_button"
      width="21"
      height="20"
      viewBox="0 0 21 20"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <ellipse cx="10.5" cy="10" rx="10.5" ry="10" fill="#D9D9D9" />
      <line
        x1="5.93577"
        y1="5.41895"
        x2="15.047"
        y2="14.5302"
        stroke="#434343"
        stroke-width="3"
        stroke-linecap="round"
      />
      <line
        x1="6.04751"
        y1="14.7812"
        x2="14.7369"
        y2="5.26683"
        stroke="#434343"
        stroke-width="3"
        stroke-linecap="round"
      />
    </svg>

    <div class="panel_title">Select up to 3 molecules</div>
    <div class="molecules">
      <div class="molecule" *ngFor="let molecule of selected">
        <dmm-molecule-summary [molecule]="molecule" [blockSet]="blockSet!">
          <div action class="action-buttons">
            <p-button
              label="Remove"
              (click)="removeFromSelected(molecule)"
            ></p-button>
          </div>
        </dmm-molecule-summary>
      </div>
    </div>
    <div class="buttons">
      <p-button
        class="secondary-button"
        label="Remove All"
        (click)="selected.length = 0"
      >
      </p-button>
      <p-button
        class="primary-button"
        label="Compare"
        (click)="comparisonViewOpen = true"
      >
      </p-button>
    </div>
  </div>
</ng-container>
