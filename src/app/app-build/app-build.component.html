<app-sidebar
  [blockSet]="blockSet"
  [currentBlockType]="currentTab"
></app-sidebar>

<div class="canvas_container" dfDropZone (drop)="dropped($event)">
  <div class="canvas_toolbar">
    <div class="button button_undo" disabled>
      <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M11.9133 5.4265H3.24663L6.95329 1.7665C7.07971 1.64008 7.15073 1.46862 7.15073 1.28983C7.15073 1.11105 7.07971 0.939584 6.95329 0.813164C6.82687 0.686744 6.65541 0.615723 6.47663 0.615723C6.29784 0.615723 6.12638 0.686744 5.99996 0.813164L0.666626 6.0865L5.99996 11.3332C6.1255 11.4578 6.29541 11.5275 6.47232 11.5269C6.64923 11.5262 6.81864 11.4554 6.94329 11.3298C7.06794 11.2043 7.13762 11.0344 7.137 10.8575C7.13637 10.6806 7.0655 10.5112 6.93996 10.3865L3.23996 6.75983H11.9066C13.5086 6.75095 15.0488 7.37748 16.1897 8.50214C17.3307 9.6268 17.9792 11.1579 17.9933 12.7598C17.9856 13.8702 17.6699 14.9566 17.0814 15.8982C16.4929 16.8399 15.6547 17.5997 14.66 18.0932C14.4955 18.1763 14.3708 18.3213 14.3133 18.4963C14.2849 18.583 14.2737 18.6744 14.2806 18.7654C14.2874 18.8564 14.3121 18.9451 14.3533 19.0265C14.3944 19.1079 14.4512 19.1804 14.5204 19.2399C14.5896 19.2994 14.6698 19.3447 14.7564 19.3731C14.9315 19.4306 15.1222 19.4163 15.2866 19.3332C16.7647 18.5873 17.9469 17.3632 18.6409 15.86C19.3349 14.3569 19.4998 12.6631 19.1088 11.0543C18.7178 9.44553 17.7939 8.01638 16.4875 6.9994C15.181 5.98242 13.5688 5.43745 11.9133 5.45317V5.4265Z" fill="currentColor"/>
      </svg>
    </div>
    <div class="button button_redo" disabled>
      <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M14 0.813337C13.8745 0.688685 13.7045 0.619008 13.5276 0.619633C13.3507 0.620258 13.1813 0.691135 13.0567 0.81667C12.932 0.942206 12.8623 1.11212 12.863 1.28903C12.8636 1.46594 12.9345 1.63535 13.06 1.76L16.7667 5.42H8.09999C6.43097 5.38531 4.80007 5.92111 3.47681 6.93885C2.15355 7.95659 1.21713 9.39536 0.822311 11.0174C0.427493 12.6394 0.597906 14.3476 1.30539 15.8596C2.01287 17.3717 3.21508 18.5971 4.71332 19.3333C4.87422 19.4156 5.06119 19.4305 5.2331 19.3749C5.40501 19.3192 5.54777 19.1976 5.62999 19.0367C5.71221 18.8758 5.72714 18.6888 5.6715 18.5169C5.61587 18.345 5.49422 18.2022 5.33332 18.12C4.33862 17.6265 3.50036 16.8667 2.91186 15.9251C2.32335 14.9835 2.00768 13.897 1.99999 12.7867C2.01408 11.1847 2.66263 9.65364 3.80354 8.52898C4.94444 7.40432 6.48465 6.77779 8.08666 6.78667H16.7533L13.06 10.44C12.9848 10.5697 12.9556 10.7208 12.9769 10.8692C12.9982 11.0175 13.0689 11.1543 13.1775 11.2575C13.2862 11.3608 13.4264 11.4244 13.5756 11.4382C13.7248 11.4519 13.8743 11.415 14 11.3333L19.3333 6.06L14 0.813337Z" fill="currentColor"/>
      </svg>
    </div>

    <div class="button button_cart" (click)="toggleCartPanel()">
      <svg width="20" height="18" viewBox="0 0 20 27" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M5.33602 2.3002H2.80002C2.1635 2.3002 1.55306 2.55305 1.10297 3.00314C0.652881 3.45323 0.400024 4.06368 0.400024 4.7002V23.9002C0.400024 24.5367 0.652881 25.1472 1.10297 25.5972C1.55306 26.0473 2.1635 26.3002 2.80002 26.3002H17.2C17.8365 26.3002 18.447 26.0473 18.8971 25.5972C19.3472 25.1472 19.6 24.5367 19.6 23.9002V4.7002C19.6 4.06368 19.3472 3.45323 18.8971 3.00314C18.447 2.55305 17.8365 2.3002 17.2 2.3002H14.664C14.4985 1.83207 14.1919 1.4268 13.7864 1.14024C13.3809 0.85368 12.8965 0.699935 12.4 0.700196H7.60002C7.1035 0.699935 6.61912 0.85368 6.21364 1.14024C5.80816 1.4268 5.50153 1.83207 5.33602 2.3002ZM7.60002 2.3002H12.4C12.6122 2.3002 12.8157 2.38448 12.9657 2.53451C13.1157 2.68454 13.2 2.88802 13.2 3.1002C13.2 3.31237 13.1157 3.51585 12.9657 3.66588C12.8157 3.81591 12.6122 3.9002 12.4 3.9002H7.60002C7.38785 3.9002 7.18437 3.81591 7.03434 3.66588C6.88431 3.51585 6.80002 3.31237 6.80002 3.1002C6.80002 2.88802 6.88431 2.68454 7.03434 2.53451C7.18437 2.38448 7.38785 2.3002 7.60002 2.3002ZM8.40002 11.1002C8.40002 10.888 8.48431 10.6845 8.63434 10.5345C8.78437 10.3845 8.98785 10.3002 9.20002 10.3002H14.8C15.0122 10.3002 15.2157 10.3845 15.3657 10.5345C15.5157 10.6845 15.6 10.888 15.6 11.1002C15.6 11.3124 15.5157 11.5159 15.3657 11.6659C15.2157 11.8159 15.0122 11.9002 14.8 11.9002H9.20002C8.98785 11.9002 8.78437 11.8159 8.63434 11.6659C8.48431 11.5159 8.40002 11.3124 8.40002 11.1002ZM8.40002 15.9002C8.40002 15.688 8.48431 15.4845 8.63434 15.3345C8.78437 15.1845 8.98785 15.1002 9.20002 15.1002H14.8C15.0122 15.1002 15.2157 15.1845 15.3657 15.3345C15.5157 15.4845 15.6 15.688 15.6 15.9002C15.6 16.1124 15.5157 16.3159 15.3657 16.4659C15.2157 16.6159 15.0122 16.7002 14.8 16.7002H9.20002C8.98785 16.7002 8.78437 16.6159 8.63434 16.4659C8.48431 16.3159 8.40002 16.1124 8.40002 15.9002ZM8.40002 20.7002C8.40002 20.488 8.48431 20.2845 8.63434 20.1345C8.78437 19.9845 8.98785 19.9002 9.20002 19.9002H14.8C15.0122 19.9002 15.2157 19.9845 15.3657 20.1345C15.5157 20.2845 15.6 20.488 15.6 20.7002C15.6 20.9124 15.5157 21.1159 15.3657 21.2659C15.2157 21.4159 15.0122 21.5002 14.8 21.5002H9.20002C8.98785 21.5002 8.78437 21.4159 8.63434 21.2659C8.48431 21.1159 8.40002 20.9124 8.40002 20.7002ZM6.80002 11.1002C6.80002 11.4185 6.6736 11.7237 6.44855 11.9487C6.22351 12.1738 5.91828 12.3002 5.60002 12.3002C5.28176 12.3002 4.97654 12.1738 4.7515 11.9487C4.52645 11.7237 4.40002 11.4185 4.40002 11.1002C4.40002 10.7819 4.52645 10.4767 4.7515 10.2517C4.97654 10.0266 5.28176 9.9002 5.60002 9.9002C5.91828 9.9002 6.22351 10.0266 6.44855 10.2517C6.6736 10.4767 6.80002 10.7819 6.80002 11.1002ZM6.80002 15.9002C6.80002 16.2185 6.6736 16.5237 6.44855 16.7487C6.22351 16.9738 5.91828 17.1002 5.60002 17.1002C5.28176 17.1002 4.97654 16.9738 4.7515 16.7487C4.52645 16.5237 4.40002 16.2185 4.40002 15.9002C4.40002 15.5819 4.52645 15.2767 4.7515 15.0517C4.97654 14.8266 5.28176 14.7002 5.60002 14.7002C5.91828 14.7002 6.22351 14.8266 6.44855 15.0517C6.6736 15.2767 6.80002 15.5819 6.80002 15.9002ZM5.60002 21.9002C5.28176 21.9002 4.97654 21.7738 4.7515 21.5487C4.52645 21.3237 4.40002 21.0185 4.40002 20.7002C4.40002 20.3819 4.52645 20.0767 4.7515 19.8517C4.97654 19.6266 5.28176 19.5002 5.60002 19.5002C5.91828 19.5002 6.22351 19.6266 6.44855 19.8517C6.6736 20.0767 6.80002 20.3819 6.80002 20.7002C6.80002 21.0185 6.6736 21.3237 6.44855 21.5487C6.22351 21.7738 5.91828 21.9002 5.60002 21.9002Z" fill="currentColor"/>
      </svg>

      My Molecule Cart ({{this.cartMoleculeList.length}})
    </div>
  </div>

  <panel *ngIf="isShowingCart && blockSet" [cartMoleculeList]="cartMoleculeList" [blockSet]="blockSet" (onClose)="onPanelClose()" (onSubmit)="sendToLab($event)" (onSendBackToWorkspace)="addToWorkSpace($event)"></panel>

  <div class="canvas_send_to_lab"
    [class.active]="isShowingSendToLab"
  >
    <div class="modal_container">
      <h2>Success &mdash; your molecule is being printed</h2>

      <div class="button" (click)="toggleSendToLabModal()">Ok</div>
    </div>
  </div>

  <svg class="svg_workspace" (mousedown)="onPanStart($event)" (mousemove)="onPan($event); onMove($event)" (mouseup)="onPanStop($event)">
    <!-- this outer-level group applies the zoom and pan -->
    <g *ngIf="blockSet" [attr.transform]="'matrix(' + zoomAndPanMatrix.join(' ') + ')'">
      <g (mouseenter)="onMouseEnter(moleculeId)" (mousedown)="onMoveStart($event, moleculeId)" (mouseleave)="onMouseLeave()" *ngFor="let molecule of moleculeList; let moleculeId = index" [attr.transform]="'translate(' + molecule.position.x + ', ' + molecule.position.y + ')'">
        <dmm-molecule-svg #wrapper [molecule]="molecule" [blockSet]="blockSet" (deleteMolecule)="onRemoveMolecule(moleculeId)" (addToCart)="addMoleculeToCart(moleculeId)" [closeOverlayObservable]="closeOverlay.asObservable()"></dmm-molecule-svg>
        <ng-container *ngTemplateOutlet="wrapper.childComponentTemplate"></ng-container>
      </g>
    </g>
  </svg>

  <div class="canvas_controls">
    <div class="button zoom_in" (click)="onZoomIn()" >
      <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M9.82837 4.646H7.82837V7.646H4.82837V9.646H7.82837V12.646H9.82837V9.646H12.8284V7.646H9.82837V4.646Z" fill="black"/>
        <path d="M8.82837 0.645996C4.41737 0.645996 0.828369 4.235 0.828369 8.646C0.828369 13.057 4.41737 16.646 8.82837 16.646C10.6033 16.6456 12.3272 16.0514 13.7254 14.958L18.1214 19.354L19.5354 17.94L15.1394 13.544C16.2334 12.1457 16.8279 10.4214 16.8284 8.646C16.8284 4.235 13.2394 0.645996 8.82837 0.645996ZM8.82837 14.646C5.51937 14.646 2.82837 11.955 2.82837 8.646C2.82837 5.337 5.51937 2.646 8.82837 2.646C12.1374 2.646 14.8284 5.337 14.8284 8.646C14.8284 11.955 12.1374 14.646 8.82837 14.646Z" fill="black"/>
      </svg>
    </div>
    <div class="button zoom_out" (click)="onZoomOut()">
      <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M4.82837 7.646H12.8284V9.646H4.82837V7.646Z" fill="black"/>
        <path d="M8.82837 16.646C10.6033 16.6456 12.3272 16.0514 13.7254 14.958L18.1214 19.354L19.5354 17.94L15.1394 13.544C16.2334 12.1457 16.8279 10.4214 16.8284 8.646C16.8284 4.235 13.2394 0.645996 8.82837 0.645996C4.41737 0.645996 0.828369 4.235 0.828369 8.646C0.828369 13.057 4.41737 16.646 8.82837 16.646ZM8.82837 2.646C12.1374 2.646 14.8284 5.337 14.8284 8.646C14.8284 11.955 12.1374 14.646 8.82837 14.646C5.51937 14.646 2.82837 11.955 2.82837 8.646C2.82837 5.337 5.51937 2.646 8.82837 2.646Z" fill="black"/>
      </svg>
    </div>
    <div class="button center" (click)="onCenter()">
      <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
        <g clip-path="url(#clip0)">
        <path d="M1.60645 10.9048H3.10145C3.30139 12.4718 4.01583 13.9293 5.1343 15.0478C6.25278 16.1663 7.71033 16.8807 9.27728 17.0806V18.5756V18.7006H9.40228H10.9614H11.0864V18.5756V17.0806C12.6534 16.8807 14.1109 16.1663 15.2294 15.0478C16.3479 13.9293 17.0623 12.4718 17.2623 10.9048H18.7573H18.8823V10.7798V9.22064V9.09564H18.7573H17.2623C17.0623 7.52869 16.3479 6.07114 15.2294 4.95266C14.1109 3.83419 12.6534 3.11975 11.0864 2.91981V1.4248V1.2998H10.9614H9.40228H9.27728V1.4248V2.91981C7.71033 3.11975 6.25278 3.83419 5.1343 4.95266C4.01583 6.07114 3.30139 7.52869 3.10145 9.09564H1.60645H1.48145V9.22064V10.7798V10.9048H1.60645ZM10.1819 15.3323C7.23391 15.3323 4.84978 12.9482 4.84978 10.0002C4.84978 7.05227 7.23391 4.66814 10.1819 4.66814C13.1298 4.66814 15.5139 7.05227 15.5139 10.0002C15.5139 12.9482 13.1298 15.3323 10.1819 15.3323Z" fill="black" stroke="black" stroke-width="0.25"/>
        </g>

        <defs>
          <clipPath id="clip0">
            <rect width="18.71" height="18.71" fill="white" transform="translate(0.826904 0.64502)"/>
          </clipPath>
        </defs>
      </svg>
    </div>
  </div>
</div>
